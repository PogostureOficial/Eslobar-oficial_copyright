<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Iniciar Sesión</title>

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    (function(){ emailjs.init("Ze_UcmuGqxNN8zCoU"); })(); /* tu public key */
  </script>

  <link rel="shortcut icon" href="logo.png" type="image/png">

  <style>
    :root{
      --w: 360px;
      --gap: 14px;
      --radius: 12px;
    }
    body{
      margin:0;
      padding:0;
      height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      background:#000;
      color:#fff;
      font-family: Arial, sans-serif;
    }
    .stack{
      width: min(90vw, var(--w));
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: var(--gap);
    }
    h1{
      margin:0 0 calc(var(--gap) * 2);
      font-size: clamp(2.2rem, 5vw, 3rem);
      line-height:1;
      text-align:center;
    }
    .input-box{
      width: 100%;
      padding: 14px;
      background:#111;
      border:1px solid rgba(255,255,255,.1);
      border-radius: var(--radius);
      outline:none;
      color:#fff;
      font-size:1rem;
      text-align:center;
      box-shadow: 0 0 10px rgba(255,255,255,.05);
      transition: box-shadow .25s ease, border-color .25s ease;
    }
    .input-box:focus{
      border-color: rgba(255,255,255,.3);
      box-shadow: 0 0 15px rgba(255,255,255,.15);
    } 
    
.phone-box {
  width: 100%;
  display: flex;
  gap: 8px;
}

.phone-box select {
  padding: 14px;
  border-radius: var(--radius);
  border: 1px solid rgba(255,255,255,.1);
  background: #111;
  color: #fff;
  font-size: 1rem;
  outline: none;
  box-shadow: 0 0 10px rgba(255,255,255,.05);
  transition: box-shadow .25s ease, border-color .25s ease;
}

.phone-box select:focus {
  border-color: rgba(255,255,255,.3);
  box-shadow: 0 0 15px rgba(255,255,255,.15);
}

.phone-box input {
  flex: 1;
}


    #enviarBtn{
      width: 100%;
      height: 0;
      padding: 0 20px;
      margin: 0;
      border: none;
      border-radius: var(--radius);
      font-weight: bold;
      cursor: pointer;
      background:#555;
      color:#bbb;
      opacity: 0;
      pointer-events: none;
      box-shadow: 0 0 0 rgba(255,255,255,0);
      transition: height .35s ease, padding .35s ease, opacity .35s ease, box-shadow .35s ease, background .2s ease, color .2s ease;
    }
    #enviarBtn.visible{
      height: 48px;
      padding: 12px 20px;
      margin-top: var(--gap);
      opacity: 1;
    }
    #enviarBtn.activo{
      background:#fff;
      color:#000;
      pointer-events:auto;
      box-shadow: 0 0 12px rgba(255,255,255,.25);
    }
    .google-wrap {
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 14px;
    }

    #googleBtn {
      width: auto !important;
      min-width: 220px;
      max-width: 300px;
      display: block;
    }

    @media (max-width:380px){
      :root{ --w: 320px; }
    }
  </style>
</head>
<body>
  <div class="stack">
    <h1>Iniciar sesión</h1>

    <!-- Inputs -->
    <div class="login-phone">
  <select id="country-code">
    <option value="+54">🇦🇷 +54</option>
    <option value="+34">🇪🇸 +34</option>
    <option value="+1">🇺🇸 +1</option>
    <option value="+52">🇲🇽 +52</option>
    <!-- Agrega más países -->
  </select>
  <input 
    type="tel" 
    id="phone-number" 
    placeholder="Introduce tu número de teléfono..." 
    pattern="[0-9]*" 
    inputmode="numeric"
    required
  />
</div>

    <input type="email" id="correo" class="input-box" placeholder="Introduce tu correo electrónico...">

    <!-- Botón normal -->
    <button id="enviarBtn" onclick="enviarCodigo()">Enviar código</button>

    <!-- Botón de Google -->
    <div class="google-wrap">
      <div id="googleBtn"></div>
    </div>
  </div>

  <script>
    // Si ya hay sesión activa, redirigir a home.html
    if(localStorage.getItem("sesion_activa") === "true"){
      window.location.href = "home.html";
    }

    const correoInput = document.getElementById("correo");
    const enviarBtn   = document.getElementById("enviarBtn");

    correoInput.addEventListener("input", () => {
      const correo = correoInput.value.trim();
      if (correo.length > 0) {
        enviarBtn.classList.add("visible");
      } else {
        enviarBtn.classList.remove("visible","activo");
      }
      if (/^[\w.+-]+@gmail\.com$/.test(correo)) {
        enviarBtn.classList.add("activo");
      } else {
        enviarBtn.classList.remove("activo");
      }
    });

    function enviarCodigo() {
      const correo = correoInput.value.trim();
      if (!correo) return;
      const codigo = Math.floor(100000 + Math.random() * 900000);
      localStorage.setItem("codigo_verificacion", codigo);
      localStorage.setItem("correo_usuario", correo);

      emailjs.send("service_nwp6u6j", "template_l73amke", {
        email: correo,
        codigo: codigo,
        time: new Date(Date.now() + 15*60000).toLocaleTimeString()
      }).then(() => {
        window.location.href = "verificacion.html";
      }, (err) => {
        alert("Error al enviar el correo: " + JSON.stringify(err));
      });
    }

   function handleCredentialResponse(response) {
  const data = parseJwt(response.credential);
  const correo = data.email;
  const foto = data.picture;

  // Guardamos correo y foto
  localStorage.setItem("correo_usuario", correo);
  localStorage.setItem("foto_usuario", foto);
  localStorage.setItem("sesion_activa", "true");

  // Generar código
  const codigo = Math.floor(100000 + Math.random() * 900000);
  localStorage.setItem("codigo_verificacion", codigo);

  emailjs.send("service_nwp6u6j", "template_l73amke", {
    email: correo,
    codigo: codigo,
    time: new Date(Date.now() + 15*60000).toLocaleTimeString()
  }).then(() => {
    window.location.href = "verificacion.html";
  }, (err) => {
    alert("Error al enviar el correo: " + JSON.stringify(err));
  });
}

    function parseJwt(token){
      var base64Url = token.split('.')[1];
      var base64 = base64Url.replace(/-/g,'+').replace(/_/g,'/');
      var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c){
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      return JSON.parse(jsonPayload);
    }

    /* === RENDER BOTÓN GOOGLE NEUTRO === */
    window.onload = function () {
      google.accounts.id.initialize({
        client_id: "681954592440-8435k741g9o7tcfluuvqhkkdr6fulgnv.apps.googleusercontent.com",
        callback: handleCredentialResponse
      });
      google.accounts.id.renderButton(
        document.getElementById("googleBtn"),
        {
          theme: "outline",
          size: "large",
          text: "signin_with",
          shape: "rectangular",
          logo_alignment: "left",
          width: "100%"
        }
      );
      google.accounts.id.disableAutoSelect();
    };
  </script>
</body>
</html>






