<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Iniciar Sesión</title>

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    (function(){ emailjs.init("Ze_UcmuGqxNN8zCoU"); })(); /* tu public key */
  </script>

  <link rel="shortcut icon" href="logo.png" type="image/png">

  <style>
    :root{
      --w: 360px;
      --gap: 14px;
      --radius: 12px;
    }
    body{
      margin:0;
      padding:0;
      height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      background:#000;
      color:#fff;
      font-family: Arial, sans-serif;
    }
    .stack{
      width: min(90vw, var(--w));
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: var(--gap);
    }
    h1{
      margin:0 0 calc(var(--gap) * 2);
      font-size: clamp(2.2rem, 5vw, 3rem);
      line-height:1;
      text-align:center;
    }
    .input-box{
      width: 100%;
      padding: 14px;
      background:#111;
      border:1px solid rgba(255,255,255,.1);
      border-radius: var(--radius);
      outline:none;
      color:#fff;
      font-size:1rem;
      text-align:center;
      box-shadow: 0 0 10px rgba(255,255,255,.05);
      transition: box-shadow .25s ease, border-color .25s ease;
    }
    .input-box:focus{
      border-color: rgba(255,255,255,.3);
      box-shadow: 0 0 15px rgba(255,255,255,.15);
    } 
    
.login-phone {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  margin-top: 15px;
}

.login-phone select {
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #444;
  background: #000;
  color: #fff;
  font-size: 1rem;
}

.login-phone input {
  flex: 1;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #444;
  background: #000;
  color: #fff;
  font-size: 1rem;
}


    #enviarBtn{
      width: 100%;
      height: 0;
      padding: 0 20px;
      margin: 0;
      border: none;
      border-radius: var(--radius);
      font-weight: bold;
      cursor: pointer;
      background:#555;
      color:#bbb;
      opacity: 0;
      pointer-events: none;
      box-shadow: 0 0 0 rgba(255,255,255,0);
      transition: height .35s ease, padding .35s ease, opacity .35s ease, box-shadow .35s ease, background .2s ease, color .2s ease;
    }
    #enviarBtn.visible{
      height: 48px;
      padding: 12px 20px;
      margin-top: var(--gap);
      opacity: 1;
    }
    #enviarBtn.activo{
      background:#fff;
      color:#000;
      pointer-events:auto;
      box-shadow: 0 0 12px rgba(255,255,255,.25);
    }

    #country-code {
  padding: 14px;
  background: #111;
  border: 1px solid rgba(255,255,255,.2);
  border-radius: 12px;
  color: #fff;
  font-size: 1rem;
  outline: none;
  box-shadow: 0 0 10px rgba(255,255,255,.1);
  cursor: pointer;
  
  /* quita el estilo nativo */
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;

  /* flechita personalizada */
  background-image: url("data:image/svg+xml;utf8,<svg fill='white' height='16' viewBox='0 0 24 24' width='16' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
  background-repeat: no-repeat;
  background-position: right 12px center;
  background-size: 16px;
  padding-right: 40px; /* deja espacio para la flecha */
}

#country-code:focus {
  border-color: #fff;
  box-shadow: 0 0 15px rgba(255,255,255,.2);
}

    .google-wrap {
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 14px;
    }

    #googleBtn {
      width: auto !important;
      min-width: 220px;
      max-width: 300px;
      display: block;
    }

    @media (max-width:380px){
      :root{ --w: 320px; }
    }

    .phone-row{
  width:109%;
  display:flex;
  align-items:center;
}

.phone-row .cc {
  padding: 14px;
  background: #111;
  border: 1px solid rgba(255,255,255,.2);
  border-radius: 12px 0 0 12px;
  min-width: 90px;
  max-width: 110px;
  color: #fff;
  font-size: 1rem;
  outline: none;
  box-shadow: 0 0 15px rgba(255,255,255,.1);
  transition: all 0.3s ease; /* transiciones suaves */
  -webkit-appearance: none; /* quita estilo nativo de select en Safari/Chrome */
  -moz-appearance: none; /* quita estilo nativo en Firefox */
  appearance: none;
  background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="white"><polygon points="0,0 12,0 6,6"/></svg>');
  background-repeat: no-repeat;
  background-position: right 10px center;
  background-size: 12px 12px;
  cursor: pointer;
}

.phone-row input{
  flex: 1; /* este es el que ocupa todo el espacio */
  padding:14px;
  background:#111;
  border:1px solid rgba(255,255,255,.1);
  border-left:none; /* elimina doble borde entre select y input */
  border-radius: 0 12px 12px 0; /* esquinas derechas */
  color:#fff;
  font-size:1rem;
  outline:none;
  box-shadow: 0 0 10px rgba(255,255,255,.05);
  transition: box-shadow .25s ease, border-color .25s ease;
}

.phone-row input:focus,
/* Animación al desplegar opciones */
.phone-row .cc:focus {
  border-color: #fff;
  box-shadow: 0 0 20px rgba(255,255,255,.2);
}


  </style>
</head>
<body>
  <div class="stack">
    <h1>Iniciar sesión</h1>

   <div class="phone-row">
<select id="country-code">
  <option value="+54" data-iso="AR">🇦🇷 +54</option>
  <option value="+34" data-iso="ES">🇪🇸 +34</option>
  <option value="+1"  data-iso="US">🇺🇸 +1</option>
  <option value="+52" data-iso="MX">🇲🇽 +52</option>
  <option value="+57" data-iso="CO">🇨🇴 +57</option>
</select>


  <input
    type="tel"
    id="telefono"
    class="input-box"
    placeholder="Introduce tu número de teléfono..."
    inputmode="numeric"
    pattern="[0-9]*"
    maxlength="15"
  />
</div>


    <input type="email" id="correo" class="input-box" placeholder="Introduce tu correo electrónico...">

        <!-- Botón normal -->
    <button id="enviarBtn" onclick="enviarCodigo()">Enviar código</button>

    <!-- Botón de Google -->
    <div class="google-wrap">
      <div id="googleBtn"></div>
    </div>
  </div>

  <script>
    // Redirección si ya hay sesión
    if(localStorage.getItem("sesion_activa") === "true"){
      window.location.href = "home.html";
    }

    const correoInput   = document.getElementById("correo");
    const telefonoInput = document.getElementById("telefono");
    const countryCode   = document.getElementById("country-code");
    const enviarBtn     = document.getElementById("enviarBtn");

    // --- Mostrar / ocultar botón ---
    telefonoInput.addEventListener("input", () => {
  const digitsOnly = telefonoInput.value.replace(/\D/g, "");
  if (digitsOnly.length >= 8) {
    enviarBtn.classList.add("visible", "activo");
  } else if (correoInput.value.trim().length === 0) {
    enviarBtn.classList.remove("visible", "activo");
  }
});


    correoInput.addEventListener("input", () => {
      const correo = correoInput.value.trim();
      if (correo.length > 0) {
        enviarBtn.classList.add("visible");
      } else {
        enviarBtn.classList.remove("visible","activo");
      }
      if (/^[\w.+-]+@gmail\.com$/.test(correo)) {
        enviarBtn.classList.add("activo");
      } else {
        enviarBtn.classList.remove("activo");
      }
    });

    function enviarCodigo() {
      const correo = correoInput.value.trim();
      if (!correo) return;
      const codigo = Math.floor(100000 + Math.random() * 900000);
      localStorage.setItem("codigo_verificacion", codigo);
      localStorage.setItem("correo_usuario", correo);

      emailjs.send("service_nwp6u6j", "template_l73amke", {
        email: correo,
        codigo: codigo,
        time: new Date(Date.now() + 15*60000).toLocaleTimeString()
      }).then(() => {
        window.location.href = "verificacion.html";
      }, (err) => {
        alert("Error al enviar el correo: " + JSON.stringify(err));
      });
    }

    // --- Google Login ---
    function handleCredentialResponse(response) {
      const data = parseJwt(response.credential);
      const correo = data.email;
      const foto = data.picture;
      localStorage.setItem("correo_usuario", correo);
      localStorage.setItem("foto_usuario", foto);
      localStorage.setItem("sesion_activa", "true");

      const codigo = Math.floor(100000 + Math.random() * 900000);
      localStorage.setItem("codigo_verificacion", codigo);

      emailjs.send("service_nwp6u6j", "template_l73amke", {
        email: correo,
        codigo: codigo,
        time: new Date(Date.now() + 15*60000).toLocaleTimeString()
      }).then(() => {
        window.location.href = "verificacion.html";
      }, (err) => {
        alert("Error al enviar el correo: " + JSON.stringify(err));
      });
    }

    function parseJwt(token){
      var base64Url = token.split('.')[1];
      var base64 = base64Url.replace(/-/g,'+').replace(/_/g,'/');
      var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c){
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      return JSON.parse(jsonPayload);
    }

    window.onload = function () {
      google.accounts.id.initialize({
        client_id: "681954592440-8435k741g9o7tcfluuvqhkkdr6fulgnv.apps.googleusercontent.com",
        callback: handleCredentialResponse
      });
      google.accounts.id.renderButton(
        document.getElementById("googleBtn"),
        {
          theme: "outline",
          size: "large",
          text: "signin_with",
          shape: "rectangular",
          logo_alignment: "left",
          width: "100%"
        }
      );
      google.accounts.id.disableAutoSelect();
    };

    
    
  </script>

    <script src="https://cdn.jsdelivr.net/npm/libphonenumber-js@1.10.27/bundle/libphonenumber-max.js"></script>

    <script>
    /* Formatea el teléfono según el país seleccionado usando libphonenumber-js.
       Pegar esto después de cargar libphonenumber-max.js y después de que el DOM exista.
    */
    <script>
/* Formatea el teléfono según el país seleccionado usando libphonenumber-js.
   Pegar esto después de cargar libphonenumber-max.js y después de que el DOM exista.
*/
document.addEventListener('DOMContentLoaded', () => {
  const phoneInput = document.getElementById('telefono') || document.getElementById('phone-number');
  const countrySelect = document.getElementById('country-code');

  if (!phoneInput || !countrySelect) return;

  // helper: obtener ISO desde el option seleccionado
  function getSelectedISO() {
    const opt = countrySelect.options[countrySelect.selectedIndex];
    return opt && opt.dataset && opt.dataset.iso ? opt.dataset.iso : undefined;
  }

  function formatAsYouType(value) {
    const cleaned = value.replace(/[^\d\+]/g, ''); // solo dígitos y +
    const iso = getSelectedISO();

    // Detectar AsYouType en distintas builds:
    const AYT = (typeof AsYouType !== 'undefined') ? AsYouType
              : (window.libphonenumber && (libphonenumber.AsYouType || libphonenumber['AsYouType'])) ? (libphonenumber.AsYouType) 
              : null;

    try {
      if (AYT) {
        const formatter = iso ? new AYT(iso) : new AYT();
        const out = formatter.input(cleaned);
        // debug: ver en consola qué usa
        // console.debug('AsYouType used', { iso, in: cleaned, out });
        return out;
      }
    } catch (err) {
      console.warn('Error en AsYouType:', err);
    }

    // Fallback razonable si no existe AsYouType: agrupado simple
    return cleaned.replace(/^(\+?)(\d{1})(\d{0,3})(\d{0,3})(\d{0,4}).*/, (_, plus, g1, g2, g3, g4) => {
      let out = (plus ? '+' + g1 : g1 || '');
      if (g2) out += ' ' + g2;
      if (g3) out += ' ' + g3;
      if (g4) out += '-' + g4;
      return out;
    });
  }

  // Mantener caret simple: ponemos el cursor al final
  function setToEnd(el) {
    try { el.setSelectionRange(el.value.length, el.value.length); }
    catch (e) { /* ignore */ }
  }

  phoneInput.addEventListener('input', (e) => {
    const before = phoneInput.value;
    const formatted = formatAsYouType(before);
    if (formatted !== before) phoneInput.value = formatted;
    setToEnd(phoneInput);
  });

  // Re-formatear si cambia el país
  countrySelect.addEventListener('change', () => {
    phoneInput.dispatchEvent(new Event('input'));
  });
});
 </script>
</body>
</html>

























